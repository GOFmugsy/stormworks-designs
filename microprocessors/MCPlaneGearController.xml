<?xml version="1.0" encoding="UTF-8"?>
<microprocessor name="Plane Gear Controller" description="" hide_in_inventory="false" width="3" length="3" id_counter="53" id_counter_node="9" transform_index="0" sym0="0" sym1="0" sym2="0" sym3="0" sym4="504" sym5="4612" sym6="14846" sym7="4102" sym8="4096" sym9="4096" sym10="4240" sym11="14840" sym12="4612" sym13="510" sym14="6" sym15="0">
	<nodes>
		<n id="1" component_id="1" built_slot_index="0">
			<node orientation="0" label="Gears Down/Up (on/off)" mode="1" type="0" description="" flags="0">
				<position x="0" y="0" z="0"/>
			</node>
		</n>
		<n id="2" component_id="4" built_slot_index="0">
			<node orientation="0" label="Front Gear Hinge" mode="0" type="1" description="Hinge Pointing Back 1 is down -1 is up" flags="0">
				<position x="0" y="0" z="1"/>
			</node>
		</n>
		<n id="3" component_id="7" built_slot_index="0">
			<node orientation="0" label="Front Gear Cover" mode="0" type="1" description="Cover for front wheel 1 is back -1 is forward" flags="0">
				<position x="1" y="0" z="1"/>
			</node>
		</n>
		<n id="4" component_id="11" built_slot_index="0">
			<node orientation="0" label="Back Left Wheel Pivot" mode="0" type="1" description="0 is down -90 is stowed" flags="0">
				<position x="2" y="0" z="0"/>
			</node>
		</n>
		<n id="5" component_id="13" built_slot_index="0">
			<node orientation="0" label="Back Right Wheel Pivot" mode="0" type="1" description="0 is down -90 is stowed" flags="0">
				<position x="2" y="0" z="1"/>
			</node>
		</n>
		<n id="6" component_id="15" built_slot_index="0">
			<node orientation="0" label="Gears Down" mode="0" type="0" description="On if down Off if up" flags="0">
				<position x="1" y="0" z="0"/>
			</node>
		</n>
		<n id="7" component_id="21" built_slot_index="0">
			<node orientation="0" label="Front Gear Hinge Current" mode="1" type="1" description="Current Hinge angle of front gear" flags="0">
				<position x="1" y="0" z="2"/>
			</node>
		</n>
		<n id="9" component_id="53" built_slot_index="0">
			<node orientation="0" label="debug" mode="0" type="6" description="The input signal to be processed." flags="0">
				<position x="0" y="0" z="2"/>
			</node>
		</n>
	</nodes>
	<group id="0">
		<pos x="0" y="0"/>
		<data type="-1696350757" name="" desc="">
			<inputs/>
			<outputs/>
		</data>
		<components>
			<c type="41">
				<object id="42" count="1" offset="0">
					<pos x="-2.75" y="2.75"/>
					<inc component_id="0" node_index="0">
						<v bools="0" 01="0" 02="0" 03="0" 04="0" 05="0" 06="0" 07="0" 08="0" 09="0" 10="0" 11="0" 12="0" 13="0" 14="0" 15="0" 16="0" 17="0" 18="0" 19="0" 20="0" 21="0" 22="0" 23="0" 24="0" 25="0" 26="0" 27="0" 28="0" 29="0" 30="0" 31="0" 32="0"/>
					</inc>
					<in1 component_id="1" node_index="0" v="false"/>
					<out1>
						<v bools="0" 01="0" 02="0" 03="0" 04="0" 05="0" 06="0" 07="0" 08="0" 09="0" 10="0" 11="0" 12="0" 13="0" 14="0" 15="0" 16="0" 17="0" 18="0" 19="0" 20="0" 21="0" 22="0" 23="0" 24="0" 25="0" 26="0" 27="0" 28="0" 29="0" 30="0" 31="0" 32="0"/>
					</out1>
				</object>
			</c>
			<c type="40">
				<object id="43" count="1" offset="1">
					<pos x="-2.75" y="2"/>
					<inc component_id="42" node_index="0">
						<v bools="0" 01="0" 02="0" 03="0" 04="0" 05="0" 06="0" 07="0" 08="0" 09="0" 10="0" 11="0" 12="0" 13="0" 14="0" 15="0" 16="0" 17="0" 18="0" 19="0" 20="0" 21="0" 22="0" 23="0" 24="0" 25="0" 26="0" 27="0" 28="0" 29="0" 30="0" 31="0" 32="0"/>
					</inc>
					<in1 component_id="21" node_index="0" v="-0.191907"/>
					<out1>
						<v bools="0" 01="0" 02="-0.191907" 03="0" 04="0" 05="0" 06="0" 07="0" 08="0" 09="0" 10="0" 11="0" 12="0" 13="0" 14="0" 15="0" 16="0" 17="0" 18="0" 19="0" 20="0" 21="0" 22="0" 23="0" 24="0" 25="0" 26="0" 27="0" 28="0" 29="0" 30="0" 31="0" 32="0"/>
					</out1>
				</object>
			</c>
			<c type="29">
				<object id="44" i="4">
					<pos x="-0.25" y="1"/>
					<in1 component_id="50" node_index="0">
						<v bools="0" 01="-1" 02="-1" 03="-90" 04="-90" 05="0" 06="0" 07="0" 08="0" 09="0" 10="0" 11="0" 12="0" 13="0" 14="0" 15="0" 16="0" 17="0" 18="0" 19="0" 20="0" 21="0" 22="0" 23="0" 24="0" 25="0" 26="0" 27="0" 28="0" 29="0" 30="0" 31="0" 32="0"/>
					</in1>
					<out1 v="false"/>
				</object>
			</c>
			<c type="31">
				<object id="45" i="3">
					<pos x="-0.25" y="1.5"/>
					<in1 component_id="50" node_index="0">
						<v bools="0" 01="-1" 02="-1" 03="-90" 04="-90" 05="0" 06="0" 07="0" 08="0" 09="0" 10="0" 11="0" 12="0" 13="0" 14="0" 15="0" 16="0" 17="0" 18="0" 19="0" 20="0" 21="0" 22="0" 23="0" 24="0" 25="0" 26="0" 27="0" 28="0" 29="0" 30="0" 31="0" 32="0"/>
					</in1>
					<out1 v="-90"/>
				</object>
			</c>
			<c type="31">
				<object id="46" i="2">
					<pos x="-0.25" y="2"/>
					<in1 component_id="50" node_index="0">
						<v bools="0" 01="-1" 02="-1" 03="-90" 04="-90" 05="0" 06="0" 07="0" 08="0" 09="0" 10="0" 11="0" 12="0" 13="0" 14="0" 15="0" 16="0" 17="0" 18="0" 19="0" 20="0" 21="0" 22="0" 23="0" 24="0" 25="0" 26="0" 27="0" 28="0" 29="0" 30="0" 31="0" 32="0"/>
					</in1>
					<out1 v="-90"/>
				</object>
			</c>
			<c type="31">
				<object id="47" i="1">
					<pos x="-0.25" y="2.5"/>
					<in1 component_id="50" node_index="0">
						<v bools="0" 01="-1" 02="-1" 03="-90" 04="-90" 05="0" 06="0" 07="0" 08="0" 09="0" 10="0" 11="0" 12="0" 13="0" 14="0" 15="0" 16="0" 17="0" 18="0" 19="0" 20="0" 21="0" 22="0" 23="0" 24="0" 25="0" 26="0" 27="0" 28="0" 29="0" 30="0" 31="0" 32="0"/>
					</in1>
					<out1 v="-1"/>
				</object>
			</c>
			<c type="31">
				<object id="49" i="0">
					<pos x="-0.25" y="3"/>
					<in1 component_id="50" node_index="0">
						<v bools="0" 01="-1" 02="-1" 03="-90" 04="-90" 05="0" 06="0" 07="0" 08="0" 09="0" 10="0" 11="0" 12="0" 13="0" 14="0" 15="0" 16="0" 17="0" 18="0" 19="0" 20="0" 21="0" 22="0" 23="0" 24="0" 25="0" 26="0" 27="0" 28="0" 29="0" 30="0" 31="0" 32="0"/>
					</in1>
					<out1 v="-1"/>
				</object>
			</c>
			<c type="56">
				<object id="50" script="
function onTick() -- 60 ticks/s
	gearDownButton = input.getBool(1)
	frontHingeState = input.getNumber(2)
	
	if gearDownButton then
		openHatch()
		lowerRear()
		lowerFront()
		if isFrontLowered(frontHingeState) then
			closeHatch()
			sendGearsDown()
			downRun = true
			upRun = false
		end
	else
		openHatch()
		raiseRear()
		raiseFront()
		if isFrontRaised(frontHingeState) then
			closeHatch()
			sendGearsUp()
			upRun = true
			downRun = false
		end
	end
end

function openHatch()
	output.setNumber(1, -1)
end
function closeHatch()
	output.setNumber(1, 1)
end
function lowerFront()
	output.setNumber(2, 1)
end
function raiseFront()
	output.setNumber(2, -1)
end
function lowerRear()
	output.setNumber(3, 0)
	output.setNumber(4, 0)
end
function raiseRear()
	output.setNumber(3, -90)
	output.setNumber(4, -90)
end
function isFrontRaised(hingeState)
	if hingeState &lt; 0 then
		return true
	else
		return false
	end
end
function isFrontLowered(hingeState)
	if hingeState &gt; 0.2 then
		return true
	else
		return false
	end
end
function sendGearsDown()
	output.setBool(5, true)
end
function sendGearsUp()
	output.setBool(5, false)
end">
					<pos x="-1.5" y="2"/>
					<in1 component_id="43" node_index="0">
						<v bools="0" 01="0" 02="-0.192284" 03="0" 04="0" 05="0" 06="0" 07="0" 08="0" 09="0" 10="0" 11="0" 12="0" 13="0" 14="0" 15="0" 16="0" 17="0" 18="0" 19="0" 20="0" 21="0" 22="0" 23="0" 24="0" 25="0" 26="0" 27="0" 28="0" 29="0" 30="0" 31="0" 32="0"/>
					</in1>
					<in2 component_id="0" node_index="0">
						<v/>
					</in2>
					<out1>
						<v bools="0" 01="-1" 02="-1" 03="-90" 04="-90" 05="0" 06="0" 07="0" 08="0" 09="0" 10="0" 11="0" 12="0" 13="0" 14="0" 15="0" 16="0" 17="0" 18="0" 19="0" 20="0" 21="0" 22="0" 23="0" 24="0" 25="0" 26="0" 27="0" 28="0" 29="0" 30="0" 31="0" 32="0"/>
					</out1>
					<out2>
						<v/>
					</out2>
				</object>
			</c>
		</components>
		<components_bridge>
			<c type="0">
				<object id="1">
					<pos x="-4" y="2.75"/>
					<in1 component_id="0" node_index="0" v="false"/>
					<out1 v="false"/>
				</object>
			</c>
			<c type="3">
				<object id="4">
					<pos x="1.25" y="2.5"/>
					<in1 component_id="47" node_index="0" v="-1"/>
					<out1 v="-1"/>
				</object>
			</c>
			<c type="3">
				<object id="7">
					<pos x="1.25" y="3"/>
					<in1 component_id="49" node_index="0" v="-1"/>
					<out1 v="-1"/>
				</object>
			</c>
			<c type="3">
				<object id="11">
					<pos x="1.25" y="2"/>
					<in1 component_id="46" node_index="0" v="-90"/>
					<out1 v="-90"/>
				</object>
			</c>
			<c type="3">
				<object id="13">
					<pos x="1.25" y="1.5"/>
					<in1 component_id="45" node_index="0" v="-90"/>
					<out1 v="-90"/>
				</object>
			</c>
			<c type="1">
				<object id="15">
					<pos x="1.25" y="1"/>
					<in1 component_id="44" node_index="0" v="false"/>
					<out1 v="false"/>
				</object>
			</c>
			<c type="2">
				<object id="21">
					<pos x="-4" y="2"/>
					<in1 component_id="0" node_index="0" v="-0.191907"/>
					<out1 v="-0.191907"/>
				</object>
			</c>
			<c type="7">
				<object id="53">
					<pos x="0" y="0"/>
					<in1 component_id="50" node_index="1">
						<v/>
					</in1>
					<out1>
						<v/>
					</out1>
				</object>
			</c>
		</components_bridge>
		<groups/>
		<component_states>
			<c0 id="42" count="1" offset="0">
				<pos x="-2.75" y="2.75"/>
				<inc component_id="0" node_index="0">
					<v bools="0" 01="0" 02="0" 03="0" 04="0" 05="0" 06="0" 07="0" 08="0" 09="0" 10="0" 11="0" 12="0" 13="0" 14="0" 15="0" 16="0" 17="0" 18="0" 19="0" 20="0" 21="0" 22="0" 23="0" 24="0" 25="0" 26="0" 27="0" 28="0" 29="0" 30="0" 31="0" 32="0"/>
				</inc>
				<in1 component_id="1" node_index="0" v="false"/>
				<out1>
					<v bools="0" 01="0" 02="0" 03="0" 04="0" 05="0" 06="0" 07="0" 08="0" 09="0" 10="0" 11="0" 12="0" 13="0" 14="0" 15="0" 16="0" 17="0" 18="0" 19="0" 20="0" 21="0" 22="0" 23="0" 24="0" 25="0" 26="0" 27="0" 28="0" 29="0" 30="0" 31="0" 32="0"/>
				</out1>
			</c0>
			<c1 id="43" count="1" offset="1">
				<pos x="-2.75" y="2"/>
				<inc component_id="42" node_index="0">
					<v bools="0" 01="0" 02="0" 03="0" 04="0" 05="0" 06="0" 07="0" 08="0" 09="0" 10="0" 11="0" 12="0" 13="0" 14="0" 15="0" 16="0" 17="0" 18="0" 19="0" 20="0" 21="0" 22="0" 23="0" 24="0" 25="0" 26="0" 27="0" 28="0" 29="0" 30="0" 31="0" 32="0"/>
				</inc>
				<in1 component_id="21" node_index="0" v="-0.191907"/>
				<out1>
					<v bools="0" 01="0" 02="-0.191907" 03="0" 04="0" 05="0" 06="0" 07="0" 08="0" 09="0" 10="0" 11="0" 12="0" 13="0" 14="0" 15="0" 16="0" 17="0" 18="0" 19="0" 20="0" 21="0" 22="0" 23="0" 24="0" 25="0" 26="0" 27="0" 28="0" 29="0" 30="0" 31="0" 32="0"/>
				</out1>
			</c1>
			<c2 id="44" i="4">
				<pos x="-0.25" y="1"/>
				<in1 component_id="50" node_index="0">
					<v bools="0" 01="-1" 02="-1" 03="-90" 04="-90" 05="0" 06="0" 07="0" 08="0" 09="0" 10="0" 11="0" 12="0" 13="0" 14="0" 15="0" 16="0" 17="0" 18="0" 19="0" 20="0" 21="0" 22="0" 23="0" 24="0" 25="0" 26="0" 27="0" 28="0" 29="0" 30="0" 31="0" 32="0"/>
				</in1>
				<out1 v="false"/>
			</c2>
			<c3 id="45" i="3">
				<pos x="-0.25" y="1.5"/>
				<in1 component_id="50" node_index="0">
					<v bools="0" 01="-1" 02="-1" 03="-90" 04="-90" 05="0" 06="0" 07="0" 08="0" 09="0" 10="0" 11="0" 12="0" 13="0" 14="0" 15="0" 16="0" 17="0" 18="0" 19="0" 20="0" 21="0" 22="0" 23="0" 24="0" 25="0" 26="0" 27="0" 28="0" 29="0" 30="0" 31="0" 32="0"/>
				</in1>
				<out1 v="-90"/>
			</c3>
			<c4 id="46" i="2">
				<pos x="-0.25" y="2"/>
				<in1 component_id="50" node_index="0">
					<v bools="0" 01="-1" 02="-1" 03="-90" 04="-90" 05="0" 06="0" 07="0" 08="0" 09="0" 10="0" 11="0" 12="0" 13="0" 14="0" 15="0" 16="0" 17="0" 18="0" 19="0" 20="0" 21="0" 22="0" 23="0" 24="0" 25="0" 26="0" 27="0" 28="0" 29="0" 30="0" 31="0" 32="0"/>
				</in1>
				<out1 v="-90"/>
			</c4>
			<c5 id="47" i="1">
				<pos x="-0.25" y="2.5"/>
				<in1 component_id="50" node_index="0">
					<v bools="0" 01="-1" 02="-1" 03="-90" 04="-90" 05="0" 06="0" 07="0" 08="0" 09="0" 10="0" 11="0" 12="0" 13="0" 14="0" 15="0" 16="0" 17="0" 18="0" 19="0" 20="0" 21="0" 22="0" 23="0" 24="0" 25="0" 26="0" 27="0" 28="0" 29="0" 30="0" 31="0" 32="0"/>
				</in1>
				<out1 v="-1"/>
			</c5>
			<c6 id="49" i="0">
				<pos x="-0.25" y="3"/>
				<in1 component_id="50" node_index="0">
					<v bools="0" 01="-1" 02="-1" 03="-90" 04="-90" 05="0" 06="0" 07="0" 08="0" 09="0" 10="0" 11="0" 12="0" 13="0" 14="0" 15="0" 16="0" 17="0" 18="0" 19="0" 20="0" 21="0" 22="0" 23="0" 24="0" 25="0" 26="0" 27="0" 28="0" 29="0" 30="0" 31="0" 32="0"/>
				</in1>
				<out1 v="-1"/>
			</c6>
			<c7 id="50" script="
function onTick() -- 60 ticks/s
	gearDownButton = input.getBool(1)
	frontHingeState = input.getNumber(2)
	
	if gearDownButton then
		openHatch()
		lowerRear()
		lowerFront()
		if isFrontLowered(frontHingeState) then
			closeHatch()
			sendGearsDown()
			downRun = true
			upRun = false
		end
	else
		openHatch()
		raiseRear()
		raiseFront()
		if isFrontRaised(frontHingeState) then
			closeHatch()
			sendGearsUp()
			upRun = true
			downRun = false
		end
	end
end

function openHatch()
	output.setNumber(1, -1)
end
function closeHatch()
	output.setNumber(1, 1)
end
function lowerFront()
	output.setNumber(2, 1)
end
function raiseFront()
	output.setNumber(2, -1)
end
function lowerRear()
	output.setNumber(3, 0)
	output.setNumber(4, 0)
end
function raiseRear()
	output.setNumber(3, -90)
	output.setNumber(4, -90)
end
function isFrontRaised(hingeState)
	if hingeState &lt; 0 then
		return true
	else
		return false
	end
end
function isFrontLowered(hingeState)
	if hingeState &gt; 0.2 then
		return true
	else
		return false
	end
end
function sendGearsDown()
	output.setBool(5, true)
end
function sendGearsUp()
	output.setBool(5, false)
end">
				<pos x="-1.5" y="2"/>
				<in1 component_id="43" node_index="0">
					<v bools="0" 01="0" 02="-0.192284" 03="0" 04="0" 05="0" 06="0" 07="0" 08="0" 09="0" 10="0" 11="0" 12="0" 13="0" 14="0" 15="0" 16="0" 17="0" 18="0" 19="0" 20="0" 21="0" 22="0" 23="0" 24="0" 25="0" 26="0" 27="0" 28="0" 29="0" 30="0" 31="0" 32="0"/>
				</in1>
				<in2 component_id="0" node_index="0">
					<v/>
				</in2>
				<out1>
					<v bools="0" 01="-1" 02="-1" 03="-90" 04="-90" 05="0" 06="0" 07="0" 08="0" 09="0" 10="0" 11="0" 12="0" 13="0" 14="0" 15="0" 16="0" 17="0" 18="0" 19="0" 20="0" 21="0" 22="0" 23="0" 24="0" 25="0" 26="0" 27="0" 28="0" 29="0" 30="0" 31="0" 32="0"/>
				</out1>
				<out2>
					<v/>
				</out2>
			</c7>
		</component_states>
		<component_bridge_states>
			<c0 id="1">
				<pos x="-4" y="2.75"/>
				<in1 component_id="0" node_index="0" v="false"/>
				<out1 v="false"/>
			</c0>
			<c1 id="4">
				<pos x="1.25" y="2.5"/>
				<in1 component_id="47" node_index="0" v="-1"/>
				<out1 v="-1"/>
			</c1>
			<c2 id="7">
				<pos x="1.25" y="3"/>
				<in1 component_id="49" node_index="0" v="-1"/>
				<out1 v="-1"/>
			</c2>
			<c3 id="11">
				<pos x="1.25" y="2"/>
				<in1 component_id="46" node_index="0" v="-90"/>
				<out1 v="-90"/>
			</c3>
			<c4 id="13">
				<pos x="1.25" y="1.5"/>
				<in1 component_id="45" node_index="0" v="-90"/>
				<out1 v="-90"/>
			</c4>
			<c5 id="15">
				<pos x="1.25" y="1"/>
				<in1 component_id="44" node_index="0" v="false"/>
				<out1 v="false"/>
			</c5>
			<c6 id="21">
				<pos x="-4" y="2"/>
				<in1 component_id="0" node_index="0" v="-0.191907"/>
				<out1 v="-0.191907"/>
			</c6>
			<c7 id="53">
				<pos x="0" y="0"/>
				<in1 component_id="50" node_index="1">
					<v/>
				</in1>
				<out1>
					<v/>
				</out1>
			</c7>
		</component_bridge_states>
		<group_states/>
	</group>
</microprocessor>

